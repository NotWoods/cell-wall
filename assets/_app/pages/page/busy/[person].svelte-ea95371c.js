import{a5 as m,S as k,i as S,s as w,e as g,k as D,t as I,c as p,a as b,n as O,g as B,d as h,b as d,K as T,L as x,f as C,H as f,h as N,I as v}from"../../../chunks/vendor-e69d1c9d.js";function R(s){function t(e){if(e)return m.exports.Temporal.Instant.from(e).toZonedDateTimeISO("UTC")}return{start:t(s.start),end:t(s.end)}}function j(s,t){for(const e of t){const{start:r,end:n}=e;if(r&&m.exports.Temporal.ZonedDateTime.compare(s,r)<0)return{busy:!1,next:e.start};if(!n||m.exports.Temporal.ZonedDateTime.compare(s,n)<=0)return{busy:!0,next:e.end}}return{busy:!1,next:void 0}}function U(s,t){const e=s.map(R);function r(){const n=m.exports.Temporal.Now.zonedDateTimeISO("UTC"),{busy:u,next:a}=j(n,e);if(t(u),a){const o=n.until(a);console.log(`Waiting until ${o}`);const i=o.total({unit:"milliseconds"});setTimeout(r,Math.max(i,1e3))}}r()}function E(s){let t,e,r,n,u,a,o=s[0].text+"",i;return{c(){t=g("body"),e=g("img"),u=D(),a=g("h1"),i=I(o),this.h()},l(c){t=p(c,"BODY",{style:!0,class:!0});var l=b(t);e=p(l,"IMG",{class:!0,alt:!0,src:!0,width:!0,height:!0}),u=O(l),a=p(l,"H1",{class:!0});var _=b(a);i=B(_,o),_.forEach(h),l.forEach(h),this.h()},h(){d(e,"class","profile svelte-8rd6l6"),d(e,"alt",r="Portrait of $"+s[1].name),T(e.src,n="$"+s[1].image)||d(e,"src",n),d(e,"width","150"),d(e,"height","150"),d(a,"class","headline-1"),x(t,"background",s[0].background),d(t,"class","svelte-8rd6l6")},m(c,l){C(c,t,l),f(t,e),f(t,u),f(t,a),f(a,i)},p(c,[l]){l&2&&r!==(r="Portrait of $"+c[1].name)&&d(e,"alt",r),l&2&&!T(e.src,n="$"+c[1].image)&&d(e,"src",n),l&1&&o!==(o=c[0].text+"")&&N(i,o),l&1&&x(t,"background",c[0].background)},i:v,o:v,d(c){c&&h(t)}}}const y={tiger:{name:"Tiger",image:"/assets/img/tiger.jpg",calendar:"tigeroakes@gmail.com"},daphne:{name:"Daphne",image:"/assets/img/daphne.jpg",calendar:"daphne.liu97@gmail.com"}},M={free:{text:"Free",background:"#262626"},busy:{text:"Busy",background:"#d87220"}};function Z(s){return s in y}const z=async({page:s})=>{const{person:t}=s.params;if(!Z(t))return{status:404,error:new Error(`No matching data for ${t}`)};const e=m.exports.Temporal.Now.zonedDateTimeISO("UTC").startOfDay(),r=e.add({days:5}),n={timeZoneName:"never",smallestUnit:"second"},u={timeMin:e.toString(n),timeMax:r.toString(n),items:[{id:y[t].calendar}]},a=await fetch("/api/third_party/freebusy",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)});if(!a.ok)return{status:a.status,error:new Error(`Could not load calendar, ${a.statusText}`)};const o=await a.json();return{props:{name:t,busyRanges:o}}};function P(s,t,e){let r,n,{busyRanges:u}=t,{name:a}=t,o="free";return U(u,i=>{e(4,o=i?"busy":"free")}),s.$$set=i=>{"busyRanges"in i&&e(2,u=i.busyRanges),"name"in i&&e(3,a=i.name)},s.$$.update=()=>{s.$$.dirty&8&&e(1,r=y[a]),s.$$.dirty&16&&e(0,n=M[o])},[n,r,u,a,o]}class H extends k{constructor(t){super();S(this,t,P,E,w,{busyRanges:2,name:3})}}export{H as default,z as load};
