import{a2 as t,S as e,i as a,s as n,e as s,k as r,t as o,c as i,a as c,n as u,g as d,d as l,b as m,K as f,L as p,f as g,H as h,h as y,I as b}from"../../../chunks/vendor-36a8e545.js";function x(e){function a(e){return e?t.exports.Temporal.Instant.from(e).toZonedDateTimeISO("UTC"):void 0}return{start:a(e.start),end:a(e.end)}}function T(e,a){const n=e.map(x);!function e(){const s=t.exports.Temporal.Now.zonedDateTimeISO("UTC"),{busy:r,next:o}=function(e,a){for(const n of a){const{start:a,end:s}=n;if(a&&t.exports.Temporal.ZonedDateTime.compare(e,a)<0)return{busy:!1,next:n.start};if(!s||t.exports.Temporal.ZonedDateTime.compare(e,s)<=0)return{busy:!0,next:n.end}}return{busy:!1,next:void 0}}(s,n);if(a(r),o){const t=s.until(o);console.log(`Waiting until ${t}`);const a=t.total({unit:"milliseconds"});setTimeout(e,Math.max(a,1e3))}}()}function v(t){let e,a,n,x,T,v,$,k=t[0].text+"";return{c(){e=s("body"),a=s("img"),T=r(),v=s("h1"),$=o(k),this.h()},l(t){e=i(t,"BODY",{style:!0,class:!0});var n=c(e);a=i(n,"IMG",{class:!0,alt:!0,src:!0,width:!0,height:!0}),T=u(n),v=i(n,"H1",{class:!0});var s=c(v);$=d(s,k),s.forEach(l),n.forEach(l),this.h()},h(){m(a,"class","profile svelte-8rd6l6"),m(a,"alt",n="Portrait of $"+t[1].name),f(a.src,x="$"+t[1].image)||m(a,"src",x),m(a,"width","150"),m(a,"height","150"),m(v,"class","headline-1"),p(e,"background",t[0].background),m(e,"class","svelte-8rd6l6")},m(t,n){g(t,e,n),h(e,a),h(e,T),h(e,v),h(v,$)},p(t,[s]){2&s&&n!==(n="Portrait of $"+t[1].name)&&m(a,"alt",n),2&s&&!f(a.src,x="$"+t[1].image)&&m(a,"src",x),1&s&&k!==(k=t[0].text+"")&&y($,k),1&s&&p(e,"background",t[0].background)},i:b,o:b,d(t){t&&l(e)}}}var $=function(t,e,a,n){return new(a||(a=Promise))((function(s,r){function o(t){try{c(n.next(t))}catch(e){r(e)}}function i(t){try{c(n.throw(t))}catch(e){r(e)}}function c(t){var e;t.done?s(t.value):(e=t.value,e instanceof a?e:new a((function(t){t(e)}))).then(o,i)}c((n=n.apply(t,e||[])).next())}))};const k={tiger:{name:"Tiger",image:"/assets/img/tiger.jpg",calendar:"tigeroakes@gmail.com"},daphne:{name:"Daphne",image:"/assets/img/daphne.jpg",calendar:"daphne.liu97@gmail.com"}},w={free:{text:"Free",background:"#262626"},busy:{text:"Busy",background:"#d87220"}};const D=({page:e})=>$(void 0,void 0,void 0,(function*(){const{person:a}=e.params;if(!function(t){return t in k}(a))return{status:404,error:new Error(`No matching data for ${a}`)};const n=t.exports.Temporal.Now.zonedDateTimeISO("UTC").startOfDay(),s=n.add({days:5}),r={timeZoneName:"never",smallestUnit:"second"},o={timeMin:n.toString(r),timeMax:s.toString(r),items:[{id:k[a].calendar}]},i=yield fetch("/api/third_party/freebusy",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!i.ok)return{status:i.status,error:new Error(`Could not load calendar, ${i.statusText}`)};return{props:{name:a,busyRanges:yield i.json()}}}));function S(t,e,a){let n,s;this&&this.__awaiter;let{busyRanges:r}=e,{name:o}=e,i="free";return T(r,(t=>{a(4,i=t?"busy":"free")})),t.$$set=t=>{"busyRanges"in t&&a(2,r=t.busyRanges),"name"in t&&a(3,o=t.name)},t.$$.update=()=>{8&t.$$.dirty&&a(1,n=k[o]),16&t.$$.dirty&&a(0,s=w[i])},[s,n,r,o,i]}class I extends e{constructor(t){super(),a(this,t,S,v,n,{busyRanges:2,name:3})}}export{I as default,D as load};
