import{U as w,aj as m,S as x,i as S,s as D,e as g,k as B,t as O,c as y,a as _,m as j,h as C,d as h,b as d,Z as T,f as v,g as I,J as f,j as R,K as k,L as U}from"../../../chunks/vendor-98a08ead.js";function N(s){function t(e){if(e)return m.Instant.from(e).toZonedDateTimeISO("UTC")}return{start:t(s.start),end:t(s.end)}}function Z(s,t){for(const e of t){const{start:r,end:n}=e;if(r&&m.ZonedDateTime.compare(s,r)<0)return{busy:!1,next:e.start};if(!n||m.ZonedDateTime.compare(s,n)<=0)return{busy:!0,next:e.end}}return{busy:!1,next:void 0}}function E(s){return w(!1,t=>{const e=s.map(N);function r(){const n=m.Now.zonedDateTimeISO("UTC"),{busy:i,next:o}=Z(n,e);if(t(i),o){const u=n.until(o);console.log(`Waiting until ${u}`);const l=u.total({unit:"milliseconds"});setTimeout(r,Math.max(l,1e3))}}r()})}function M(s){let t,e,r,n,i,o,u=s[0].text+"",l;return{c(){t=g("body"),e=g("img"),i=B(),o=g("h1"),l=O(u),this.h()},l(a){t=y(a,"BODY",{style:!0,class:!0});var c=_(t);e=y(c,"IMG",{class:!0,alt:!0,src:!0,width:!0,height:!0}),i=j(c),o=y(c,"H1",{class:!0});var b=_(o);l=C(b,u),b.forEach(h),c.forEach(h),this.h()},h(){d(e,"class","profile svelte-8rd6l6"),d(e,"alt",r="Portrait of $"+s[1].name),T(e.src,n="$"+s[1].image)||d(e,"src",n),d(e,"width","150"),d(e,"height","150"),d(o,"class","headline-1"),v(t,"background",s[0].background),d(t,"class","svelte-8rd6l6")},m(a,c){I(a,t,c),f(t,e),f(t,i),f(t,o),f(o,l)},p(a,[c]){c&2&&r!==(r="Portrait of $"+a[1].name)&&d(e,"alt",r),c&2&&!T(e.src,n="$"+a[1].image)&&d(e,"src",n),c&1&&u!==(u=a[0].text+"")&&R(l,u),c&1&&v(t,"background",a[0].background)},i:k,o:k,d(a){a&&h(t)}}}async function P(s){return await fetch("/api/third_party/freebusy",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})}const p={tiger:{name:"Tiger",image:"/assets/img/tiger.jpg",calendar:"tigeroakes@gmail.com"},daphne:{name:"Daphne",image:"/assets/img/daphne.jpg",calendar:"daphne.liu97@gmail.com"}},q={free:{text:"Free",background:"#262626"},busy:{text:"Busy",background:"#d87220"}};function z(s){return s in p}const F=async({params:s})=>{const{person:t}=s;if(!z(t))return{status:404,error:new Error(`No matching data for ${t}`)};const e=m.Now.zonedDateTimeISO("UTC").startOfDay(),r=e.add({days:5}),n={timeZoneName:"never",smallestUnit:"second"},i=await P({timeMin:e.toString(n),timeMax:r.toString(n),items:[{id:p[t].calendar}]});if(!i.ok)return{status:i.status,error:new Error(`Could not load calendar, ${i.statusText}`)};const o=await i.json();return{props:{name:t,busyRanges:o}}};function J(s,t,e){let r,n,i,{busyRanges:o}=t,{name:u}=t;const l=E(o);return U(s,l,a=>e(5,i=a)),s.$$set=a=>{"busyRanges"in a&&e(3,o=a.busyRanges),"name"in a&&e(4,u=a.name)},s.$$.update=()=>{s.$$.dirty&16&&e(1,r=p[u]),s.$$.dirty&32&&e(0,n=q[i?"busy":"free"])},[n,r,l,o,u,i]}class G extends x{constructor(t){super();S(this,t,J,M,D,{busyRanges:3,name:4})}}export{G as default,F as load};
