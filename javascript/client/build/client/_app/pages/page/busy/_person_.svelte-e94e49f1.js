import{U as w,ai as m,S as x,i as S,s as D,e as g,k as B,t as O,c as p,a as _,m as C,h as I,d as y,b as d,Z as T,f as v,g as R,J as f,j as U,K as k,L as j}from"../../../chunks/vendor-7aa287fa.js";function N(s){function t(e){if(e)return m.Instant.from(e).toZonedDateTimeISO("UTC")}return{start:t(s.start),end:t(s.end)}}function Z(s,t){for(const e of t){const{start:n,end:a}=e;if(n&&m.ZonedDateTime.compare(s,n)<0)return{busy:!1,next:e.start};if(!a||m.ZonedDateTime.compare(s,a)<=0)return{busy:!0,next:e.end}}return{busy:!1,next:void 0}}function E(s){return w(!1,t=>{const e=s.map(N);function n(){const a=m.Now.zonedDateTimeISO("UTC"),{busy:r,next:o}=Z(a,e);if(t(r),o){const u=a.until(o);console.log(`Waiting until ${u}`);const i=u.total({unit:"milliseconds"});setTimeout(n,Math.max(i,1e3))}}n()})}function M(s){let t,e,n,a,r,o,u=s[1].text+"",i;return{c(){t=g("body"),e=g("img"),r=B(),o=g("h1"),i=O(u),this.h()},l(l){t=p(l,"BODY",{style:!0,class:!0});var c=_(t);e=p(c,"IMG",{class:!0,alt:!0,src:!0,width:!0,height:!0}),r=C(c),o=p(c,"H1",{class:!0});var b=_(o);i=I(b,u),b.forEach(y),c.forEach(y),this.h()},h(){d(e,"class","profile svelte-8rd6l6"),d(e,"alt",n="Portrait of $"+s[0].name),T(e.src,a="$"+s[0].image)||d(e,"src",a),d(e,"width","150"),d(e,"height","150"),d(o,"class","headline-1"),v(t,"background",s[1].background),d(t,"class","svelte-8rd6l6")},m(l,c){R(l,t,c),f(t,e),f(t,r),f(t,o),f(o,i)},p(l,[c]){c&1&&n!==(n="Portrait of $"+l[0].name)&&d(e,"alt",n),c&1&&!T(e.src,a="$"+l[0].image)&&d(e,"src",a),c&2&&u!==(u=l[1].text+"")&&U(i,u),c&2&&v(t,"background",l[1].background)},i:k,o:k,d(l){l&&y(t)}}}async function P(s){return await fetch("/api/third_party/freebusy",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})}const h={tiger:{name:"Tiger",image:"/assets/img/tiger.jpg",calendar:"tigeroakes@gmail.com"},daphne:{name:"Daphne",image:"/assets/img/daphne.jpg",calendar:"daphne.liu97@gmail.com"}},q={free:{text:"Free",background:"#262626"},busy:{text:"Busy",background:"#d87220"}};function z(s){return s in h}const F=async({params:s})=>{const{person:t}=s;if(!z(t))return{status:404,error:new Error(`No matching data for ${t}`)};const e=m.Now.zonedDateTimeISO("UTC").startOfDay(),n=e.add({days:5}),a={timeZoneName:"never",smallestUnit:"second"},r=await P({timeMin:e.toString(a),timeMax:n.toString(a),items:[{id:h[t].calendar}]});if(!r.ok)return{status:r.status,error:new Error(`Could not load calendar, ${r.statusText}`)};const o=await r.json();return{props:{person:h[t],busyRanges:o}}};function J(s,t,e){let n,a,{busyRanges:r}=t,{person:o}=t;const u=E(r);return j(s,u,i=>e(4,a=i)),s.$$set=i=>{"busyRanges"in i&&e(3,r=i.busyRanges),"person"in i&&e(0,o=i.person)},s.$$.update=()=>{s.$$.dirty&16&&e(1,n=q[a?"busy":"free"])},[o,n,u,r,a]}class G extends x{constructor(t){super();S(this,t,J,M,D,{busyRanges:3,person:0})}}export{G as default,F as load};
