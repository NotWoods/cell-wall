import{af as m,S as x,i as S,s as w,e as g,k as D,t as O,c as h,a as b,m as j,h as B,d as y,b as d,V as T,f as v,g as C,J as f,j as I,K as k}from"../../../chunks/vendor-972526c7.js";function N(s){function t(e){if(e)return m.Instant.from(e).toZonedDateTimeISO("UTC")}return{start:t(s.start),end:t(s.end)}}function R(s,t){for(const e of t){const{start:r,end:n}=e;if(r&&m.ZonedDateTime.compare(s,r)<0)return{busy:!1,next:e.start};if(!n||m.ZonedDateTime.compare(s,n)<=0)return{busy:!0,next:e.end}}return{busy:!1,next:void 0}}function U(s,t){const e=s.map(N);function r(){const n=m.Now.zonedDateTimeISO("UTC"),{busy:u,next:a}=R(n,e);if(t(u),a){const o=n.until(a);console.log(`Waiting until ${o}`);const i=o.total({unit:"milliseconds"});setTimeout(r,Math.max(i,1e3))}}r()}function E(s){let t,e,r,n,u,a,o=s[0].text+"",i;return{c(){t=g("body"),e=g("img"),u=D(),a=g("h1"),i=O(o),this.h()},l(l){t=h(l,"BODY",{style:!0,class:!0});var c=b(t);e=h(c,"IMG",{class:!0,alt:!0,src:!0,width:!0,height:!0}),u=j(c),a=h(c,"H1",{class:!0});var _=b(a);i=B(_,o),_.forEach(y),c.forEach(y),this.h()},h(){d(e,"class","profile svelte-8rd6l6"),d(e,"alt",r="Portrait of $"+s[1].name),T(e.src,n="$"+s[1].image)||d(e,"src",n),d(e,"width","150"),d(e,"height","150"),d(a,"class","headline-1"),v(t,"background",s[0].background),d(t,"class","svelte-8rd6l6")},m(l,c){C(l,t,c),f(t,e),f(t,u),f(t,a),f(a,i)},p(l,[c]){c&2&&r!==(r="Portrait of $"+l[1].name)&&d(e,"alt",r),c&2&&!T(e.src,n="$"+l[1].image)&&d(e,"src",n),c&1&&o!==(o=l[0].text+"")&&I(i,o),c&1&&v(t,"background",l[0].background)},i:k,o:k,d(l){l&&y(t)}}}const p={tiger:{name:"Tiger",image:"/assets/img/tiger.jpg",calendar:"tigeroakes@gmail.com"},daphne:{name:"Daphne",image:"/assets/img/daphne.jpg",calendar:"daphne.liu97@gmail.com"}},M={free:{text:"Free",background:"#262626"},busy:{text:"Busy",background:"#d87220"}};function Z(s){return s in p}const z=async({params:s})=>{const{person:t}=s;if(!Z(t))return{status:404,error:new Error(`No matching data for ${t}`)};const e=m.Now.zonedDateTimeISO("UTC").startOfDay(),r=e.add({days:5}),n={timeZoneName:"never",smallestUnit:"second"},u={timeMin:e.toString(n),timeMax:r.toString(n),items:[{id:p[t].calendar}]},a=await fetch("/api/third_party/freebusy",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)});if(!a.ok)return{status:a.status,error:new Error(`Could not load calendar, ${a.statusText}`)};const o=await a.json();return{props:{name:t,busyRanges:o}}};function P(s,t,e){let r,n,{busyRanges:u}=t,{name:a}=t,o="free";return U(u,i=>{e(4,o=i?"busy":"free")}),s.$$set=i=>{"busyRanges"in i&&e(2,u=i.busyRanges),"name"in i&&e(3,a=i.name)},s.$$.update=()=>{s.$$.dirty&8&&e(1,r=p[a]),s.$$.dirty&16&&e(0,n=M[o])},[n,r,u,a,o]}class J extends x{constructor(t){super();S(this,t,P,E,w,{busyRanges:2,name:3})}}export{J as default,z as load};
