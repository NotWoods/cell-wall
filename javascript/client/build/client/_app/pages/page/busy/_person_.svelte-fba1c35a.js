import{ak as m,S as w,i as x,s as S,e as g,k as D,t as O,c as y,a as b,m as B,h as C,d as h,b as d,Z as T,f as k,g as I,J as f,j as N,K as v}from"../../../chunks/vendor-e399076d.js";function R(a){function t(e){if(e)return m.Instant.from(e).toZonedDateTimeISO("UTC")}return{start:t(a.start),end:t(a.end)}}function j(a,t){for(const e of t){const{start:n,end:s}=e;if(n&&m.ZonedDateTime.compare(a,n)<0)return{busy:!1,next:e.start};if(!s||m.ZonedDateTime.compare(a,s)<=0)return{busy:!0,next:e.end}}return{busy:!1,next:void 0}}function U(a,t){const e=a.map(R);function n(){const s=m.Now.zonedDateTimeISO("UTC"),{busy:o,next:r}=j(s,e);if(t(o),r){const u=s.until(r);console.log(`Waiting until ${u}`);const i=u.total({unit:"milliseconds"});setTimeout(n,Math.max(i,1e3))}}n()}function Z(a){let t,e,n,s,o,r,u=a[0].text+"",i;return{c(){t=g("body"),e=g("img"),o=D(),r=g("h1"),i=O(u),this.h()},l(l){t=y(l,"BODY",{style:!0,class:!0});var c=b(t);e=y(c,"IMG",{class:!0,alt:!0,src:!0,width:!0,height:!0}),o=B(c),r=y(c,"H1",{class:!0});var _=b(r);i=C(_,u),_.forEach(h),c.forEach(h),this.h()},h(){d(e,"class","profile svelte-8rd6l6"),d(e,"alt",n="Portrait of $"+a[1].name),T(e.src,s="$"+a[1].image)||d(e,"src",s),d(e,"width","150"),d(e,"height","150"),d(r,"class","headline-1"),k(t,"background",a[0].background),d(t,"class","svelte-8rd6l6")},m(l,c){I(l,t,c),f(t,e),f(t,o),f(t,r),f(r,i)},p(l,[c]){c&2&&n!==(n="Portrait of $"+l[1].name)&&d(e,"alt",n),c&2&&!T(e.src,s="$"+l[1].image)&&d(e,"src",s),c&1&&u!==(u=l[0].text+"")&&N(i,u),c&1&&k(t,"background",l[0].background)},i:v,o:v,d(l){l&&h(t)}}}async function E(a){return await fetch("/api/third_party/freebusy",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})}const p={tiger:{name:"Tiger",image:"/assets/img/tiger.jpg",calendar:"tigeroakes@gmail.com"},daphne:{name:"Daphne",image:"/assets/img/daphne.jpg",calendar:"daphne.liu97@gmail.com"}},M={free:{text:"Free",background:"#262626"},busy:{text:"Busy",background:"#d87220"}};function P(a){return a in p}const J=async({params:a})=>{const{person:t}=a;if(!P(t))return{status:404,error:new Error(`No matching data for ${t}`)};const e=m.Now.zonedDateTimeISO("UTC").startOfDay(),n=e.add({days:5}),s={timeZoneName:"never",smallestUnit:"second"},o=await E({timeMin:e.toString(s),timeMax:n.toString(s),items:[{id:p[t].calendar}]});if(!o.ok)return{status:o.status,error:new Error(`Could not load calendar, ${o.statusText}`)};const r=await o.json();return{props:{name:t,busyRanges:r}}};function q(a,t,e){let n,s,{busyRanges:o}=t,{name:r}=t,u="free";return U(o,i=>{e(4,u=i?"busy":"free")}),a.$$set=i=>{"busyRanges"in i&&e(2,o=i.busyRanges),"name"in i&&e(3,r=i.name)},a.$$.update=()=>{a.$$.dirty&8&&e(1,n=p[r]),a.$$.dirty&16&&e(0,s=M[u])},[s,n,o,r,u]}class W extends w{constructor(t){super();x(this,t,q,Z,S,{busyRanges:2,name:3})}}export{W as default,J as load};
