var X=Object.defineProperty,G=Object.defineProperties;var K=Object.getOwnPropertyDescriptors;var k=Object.getOwnPropertySymbols;var V=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable;var J=(a,e,i)=>e in a?X(a,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):a[e]=i,W=(a,e)=>{for(var i in e||(e={}))V.call(e,i)&&J(a,i,e[i]);if(k)for(var i of k(e))z.call(e,i)&&J(a,i,e[i]);return a},C=(a,e)=>G(a,K(e));var P=(a,e)=>{var i={};for(var t in a)V.call(a,t)&&e.indexOf(t)<0&&(i[t]=a[t]);if(a!=null&&k)for(var t of k(a))e.indexOf(t)<0&&z.call(a,t)&&(i[t]=a[t]);return i};import{V as B,D as Q,U as Y,S as Z,i as x,s as ee,w as N,x as y,y as q,q as _,o as $,B as S,k as w,X as te,d,m as b,g as p,p as ne,L as ie,af as ae,n as re,e as E,c as L,b as m,ag as F,O as j}from"../../chunks/vendor-e399076d.js";import{g as se}from"../../chunks/navigation-0e6511d1.js";import{R as le}from"../../chunks/ResetSubmit-e100b998.js";import{V as D}from"../../chunks/VerticalField-2c292413.js";import{F as oe}from"../../chunks/SubmitButton-bf07f081.js";import{R as ue,T as fe}from"../../chunks/TopBar-bec206db.js";import{p as ce}from"../../chunks/_form-52443b97.js";import"../../chunks/singletons-d1fb5791.js";import"../../chunks/snackbar-host-867f3ede.js";const me=!0;function M(){const a=Q({active:!1});return{state:a,active:B(a,e=>e.active),error:B(a,e=>e.error)}}function de(){const a=new AbortController,l=M(),{state:e}=l,i=P(l,["state"]);async function t(){try{await document.documentElement.requestFullscreen().then(()=>e.set({active:!0}),n=>e.set({active:!1,error:n})),e.set({active:!0})}catch(n){if(n instanceof Error)e.set({active:!1,error:n});else throw n}}return t(),document.addEventListener("fullscreenchange",()=>{e.set({active:Boolean(document.fullscreenElement)})},a),C(W({},i),{async release(){a.abort(),await document.exitFullscreen()}})}function pe(){if("wakeLock"in navigator){let e=function(){t!==null&&document.visibilityState==="visible"&&s()};const i=new AbortController;let t;const a=M(),{state:l}=a,n=P(a,["state"]);async function s(){try{t=await navigator.wakeLock.request("screen"),l.set({active:!0}),t.addEventListener("release",()=>{l.set({active:!1})},i)}catch(u){if(u instanceof DOMException)l.set({active:!1,error:u});else throw u}}return s(),document.addEventListener("visibilitychange",e,i),document.addEventListener("fullscreenchange",e,i),C(W({},n),{async release(){i.abort(),await(t==null?void 0:t.release())}})}else return}function _e(){function a(){return{innerWidth:window.innerWidth,innerHeight:window.innerHeight}}return Y(a(),e=>{function i(){e(a())}return window.addEventListener("resize",i),()=>window.removeEventListener("resize",i)})}const{document:A}=ae;function O(a){let e,i;return e=new fe({}),{c(){N(e.$$.fragment)},l(t){y(e.$$.fragment,t)},m(t,l){q(e,t,l),i=!0},i(t){i||(_(e.$$.fragment,t),i=!0)},o(t){$(e.$$.fragment,t),i=!1},d(t){S(e,t)}}}function ve(a){let e,i,t,l;return{c(){e=E("input"),this.h()},l(n){e=L(n,"INPUT",{id:!0,class:!0,name:!0,type:!0}),this.h()},h(){m(e,"id","control-id"),m(e,"class",i=a[9]),m(e,"name","id"),m(e,"type","text"),e.required=!0},m(n,s){p(n,e,s),F(e,a[0]),t||(l=j(e,"input",a[6]),t=!0)},p(n,s){s&512&&i!==(i=n[9])&&m(e,"class",i),s&1&&e.value!==n[0]&&F(e,n[0])},d(n){n&&d(e),t=!1,l()}}}function $e(a){let e,i,t,l;return{c(){e=E("input"),this.h()},l(n){e=L(n,"INPUT",{id:!0,class:!0,name:!0,type:!0}),this.h()},h(){m(e,"id","control-name"),m(e,"class",i=a[9]),m(e,"name","deviceName"),m(e,"type","text"),e.required=!0},m(n,s){p(n,e,s),F(e,a[1]),t||(l=j(e,"input",a[7]),t=!0)},p(n,s){s&512&&i!==(i=n[9])&&m(e,"class",i),s&2&&e.value!==n[1]&&F(e,n[1])},d(n){n&&d(e),t=!1,l()}}}function he(a){let e,i,t,l,n,s,u,c,h,g,o,v;return e=new D({props:{for:"control-id",label:"ID",$$slots:{default:[ve,({inputClassName:r})=>({9:r}),({inputClassName:r})=>r?512:0]},$$scope:{ctx:a}}}),t=new D({props:{for:"control-name",label:"Name",$$slots:{default:[$e,({inputClassName:r})=>({9:r}),({inputClassName:r})=>r?512:0]},$$scope:{ctx:a}}}),o=new le({props:{loading:a[8]}}),{c(){N(e.$$.fragment),i=w(),N(t.$$.fragment),l=w(),n=E("input"),u=w(),c=E("input"),g=w(),N(o.$$.fragment),this.h()},l(r){y(e.$$.fragment,r),i=b(r),y(t.$$.fragment,r),l=b(r),n=L(r,"INPUT",{type:!0,name:!0}),u=b(r),c=L(r,"INPUT",{type:!0,name:!0}),g=b(r),y(o.$$.fragment,r),this.h()},h(){var r,f;m(n,"type","hidden"),m(n,"name","width"),n.value=s=(r=a[3])==null?void 0:r.innerWidth,m(c,"type","hidden"),m(c,"name","height"),c.value=h=(f=a[3])==null?void 0:f.innerHeight},m(r,f){q(e,r,f),p(r,i,f),q(t,r,f),p(r,l,f),p(r,n,f),p(r,u,f),p(r,c,f),p(r,g,f),q(o,r,f),v=!0},p(r,f){var H,I;const R={};f&1537&&(R.$$scope={dirty:f,ctx:r}),e.$set(R);const T={};f&1538&&(T.$$scope={dirty:f,ctx:r}),t.$set(T),(!v||f&8&&s!==(s=(H=r[3])==null?void 0:H.innerWidth))&&(n.value=s),(!v||f&8&&h!==(h=(I=r[3])==null?void 0:I.innerHeight))&&(c.value=h);const U={};f&256&&(U.loading=r[8]),o.$set(U)},i(r){v||(_(e.$$.fragment,r),_(t.$$.fragment,r),_(o.$$.fragment,r),v=!0)},o(r){$(e.$$.fragment,r),$(t.$$.fragment,r),$(o.$$.fragment,r),v=!1},d(r){S(e,r),r&&d(i),S(t,r),r&&d(l),r&&d(n),r&&d(u),r&&d(c),r&&d(g),S(o,r)}}}function ge(a){let e,i;return e=new oe({props:{class:"flex flex-col gap-y-4",action:"/api/device/"+a[0],onSubmit:a[5],$$slots:{default:[he,({loading:t})=>({8:t}),({loading:t})=>t?256:0]},$$scope:{ctx:a}}}),{c(){N(e.$$.fragment)},l(t){y(e.$$.fragment,t)},m(t,l){q(e,t,l),i=!0},p(t,l){const n={};l&1&&(n.action="/api/device/"+t[0]),l&1291&&(n.$$scope={dirty:l,ctx:t}),e.$set(n)},i(t){i||(_(e.$$.fragment,t),i=!0)},o(t){$(e.$$.fragment,t),i=!1},d(t){S(e,t)}}}function we(a){let e,i,t,l,n=!a[2]&&O();return t=new ue({props:{$$slots:{default:[ge]},$$scope:{ctx:a}}}),{c(){e=w(),n&&n.c(),i=w(),N(t.$$.fragment),this.h()},l(s){te('[data-svelte="svelte-1rqvp1e"]',A.head).forEach(d),e=b(s),n&&n.l(s),i=b(s),y(t.$$.fragment,s),this.h()},h(){A.title="New Cell | CellWall"},m(s,u){p(s,e,u),n&&n.m(s,u),p(s,i,u),q(t,s,u),l=!0},p(s,[u]){s[2]?n&&(re(),$(n,1,1,()=>{n=null}),ne()):n?u&4&&_(n,1):(n=O(),n.c(),_(n,1),n.m(i.parentNode,i));const c={};u&1035&&(c.$$scope={dirty:u,ctx:s}),t.$set(c)},i(s){l||(_(n),_(t.$$.fragment,s),l=!0)},o(s){$(n),$(t.$$.fragment,s),l=!1},d(s){s&&d(e),n&&n.d(s),s&&d(i),S(t,s)}}}const Pe=async({url:a})=>({props:{id:a.searchParams.get("id")||"",deviceName:a.searchParams.get("name")||"",autoJoin:a.searchParams.has("autojoin")}});function be(a,e,i){let t;const l=_e();ie(a,l,o=>i(3,t=o));let{id:n=""}=e,{deviceName:s=""}=e,{autoJoin:u=!1}=e;async function c(o,v){const r={serial:o.get("id"),deviceName:o.get("deviceName"),width:t==null?void 0:t.innerWidth,height:t==null?void 0:t.innerHeight};console.log("submitting",r),de(),pe(),await ce(v.toString(),r),await se(`/cell/frame/blank?id=${n}`,{replaceState:!1})}function h(){n=this.value,i(0,n)}function g(){s=this.value,i(1,s)}return a.$$set=o=>{"id"in o&&i(0,n=o.id),"deviceName"in o&&i(1,s=o.deviceName),"autoJoin"in o&&i(2,u=o.autoJoin)},a.$$.update=()=>{if(a.$$.dirty&4&&u&&me){const o=document.querySelector("form");c(new FormData(o),new URL(o.action))}},[n,s,u,t,l,c,h,g]}class Re extends Z{constructor(e){super();x(this,e,be,we,ee,{id:0,deviceName:1,autoJoin:2})}}export{Re as default,Pe as load};
