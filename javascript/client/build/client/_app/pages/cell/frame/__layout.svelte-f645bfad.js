import{U as q,S as w,i as E,s as m,e as B,c as D,a as P,d as c,b as I,g as p,G as k,H as L,I as C,q as f,P as J,Q as y,o as d,l as g,n as N,K as O,p as T,F as z,ah as h,ai as b,W,k as j,w as A,X as F,m as H,x as M,y as R,B as G,L as K,r as Q}from"../../../chunks/vendor-e399076d.js";import{g as U}from"../../../chunks/navigation-0e6511d1.js";import{b as v}from"../../../chunks/cell-state-schema-b294815b.js";import"../../../chunks/singletons-d1fb5791.js";function V(t){return new WebSocket(`ws://${window.location.host}/cells/${t}`)}function X(t){return Boolean(t&&typeof t=="object"&&"type"in t)}function Y(t){return t instanceof ArrayBuffer?t.byteLength===0:t instanceof Blob?t.size===0:!1}function Z(t){let s=v;return q(v,r=>{const o=new AbortController;function e({data:n}){if(typeof n=="string"){const a=JSON.parse(n);if(X(a)){s=a;return}}Y(n)||(s.payload=n),r(s)}return t==null||t.addEventListener("message",e,o),()=>o.abort()})}function x(t,s){if(t){const r=()=>{const o={width:window.innerWidth,height:window.innerHeight};console.log(t.readyState,"socket ready state"),t.send(JSON.stringify(o))};document.addEventListener("resize",r,s),t.addEventListener("close",()=>{document.removeEventListener("resize",r)})}}function $(t){let s,r,o;const e=t[2].default,n=z(e,t,t[1],null);return{c(){s=B("div"),n&&n.c(),this.h()},l(a){s=D(a,"DIV",{class:!0});var i=P(s);n&&n.l(i),i.forEach(c),this.h()},h(){I(s,"class","layout svelte-e2gi4i")},m(a,i){p(a,s,i),n&&n.m(s,null),o=!0},p(a,i){t=a,n&&n.p&&(!o||i&2)&&k(n,e,t,t[1],o?C(e,t[1],i,null):L(t[1]),null)},i(a){o||(f(n,a),J(()=>{r||(r=y(s,b,{duration:S,easing:h},!0)),r.run(1)}),o=!0)},o(a){d(n,a),r||(r=y(s,b,{duration:S,easing:h},!1)),r.run(0),o=!1},d(a){a&&c(s),n&&n.d(a),a&&r&&r.end()}}}function ee(t){let s=t[0],r,o,e=$(t);return{c(){e.c(),r=g()},l(n){e.l(n),r=g()},m(n,a){e.m(n,a),p(n,r,a),o=!0},p(n,[a]){a&1&&m(s,s=n[0])?(N(),d(e,1,1,O),T(),e=$(n),e.c(),f(e),e.m(r.parentNode,r)):e.p(n,a)},i(n){o||(f(e),o=!0)},o(n){d(e),o=!1},d(n){n&&c(r),e.d(n)}}}const S=300;function te(t,s,r){let{$$slots:o={},$$scope:e}=s,{key:n=""}=s;return t.$$set=a=>{"key"in a&&r(0,n=a.key),"$$scope"in a&&r(1,e=a.$$scope)},[n,e,o]}class ne extends w{constructor(s){super();E(this,s,te,ee,m,{key:0})}}function se(t){let s;const r=t[4].default,o=z(r,t,t[5],null);return{c(){o&&o.c()},l(e){o&&o.l(e)},m(e,n){o&&o.m(e,n),s=!0},p(e,n){o&&o.p&&(!s||n&32)&&k(o,r,e,e[5],s?C(r,e[5],n,null):L(e[5]),null)},i(e){s||(f(o,e),s=!0)},o(e){d(o,e),s=!1},d(e){o&&o.d(e)}}}function re(t){let s,r,o;return r=new ne({props:{key:t[0],$$slots:{default:[se]},$$scope:{ctx:t}}}),{c(){s=j(),A(r.$$.fragment),this.h()},l(e){F('[data-svelte="svelte-al2hjo"]',document.head).forEach(c),s=H(e),M(r.$$.fragment,e),this.h()},h(){document.title="Cell"},m(e,n){p(e,s,n),R(r,e,n),o=!0},p(e,[n]){const a={};n&1&&(a.key=e[0]),n&32&&(a.$$scope={dirty:n,ctx:e}),r.$set(a)},i(e){o||(f(r.$$.fragment,e),o=!0)},o(e){d(r.$$.fragment,e),o=!1},d(e){e&&c(s),G(r,e)}}}function ce(){return W("frame")}const fe=async({url:t})=>{const s=t.searchParams.get("id");return s?{props:{serial:s}}:{status:400,error:new Error("Missing ID")}};function oe(t,s,r){let o,e,{$$slots:n={},$$scope:a}=s,{serial:i}=s;const l=V(i),_=Z(l);return K(t,_,u=>r(3,e=u)),x(l),Q("frame",{socket:l,state:_}),l==null||l.addEventListener("error",u=>console.error("Socket error",u)),l==null||l.addEventListener("open",u=>console.info("Socket open",u)),l==null||l.addEventListener("close",u=>console.info("Socket close",u)),t.$$set=u=>{"serial"in u&&r(2,i=u.serial),"$$scope"in u&&r(5,a=u.$$scope)},t.$$.update=()=>{t.$$.dirty&8&&r(0,o=`/cell/frame/${e.type.toLowerCase()}`),t.$$.dirty&8&&console.log("CellState",e),t.$$.dirty&5&&U(`${o}?id=${i}`,{replaceState:!0})},[o,_,i,e,n,a]}class de extends w{constructor(s){super();E(this,s,oe,re,m,{serial:2})}}export{de as default,ce as getFrameContext,fe as load};
