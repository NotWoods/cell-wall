import{U as q,S,i as E,s as m,e as B,c as D,a as P,d as c,b as I,g as p,G as L,H as k,I as C,q as f,P as J,Q as h,o as d,l as g,n as M,K as N,p as O,F as z,ag as y,ah as b,W as T,k as W,w as j,X as A,m as F,x as H,y as R,B as G,L as K,v as Q,r as U}from"../../../chunks/vendor-75710b0b.js";import{g as V}from"../../../chunks/navigation-0e6511d1.js";import{b as v}from"../../../chunks/cell-state-schema-b294815b.js";import"../../../chunks/singletons-d1fb5791.js";function X(t){return new WebSocket(`ws://${window.location.host}/cells/${t}`)}function Y(t){return Boolean(t&&typeof t=="object"&&"type"in t)}function Z(t){return t instanceof ArrayBuffer?t.byteLength===0:t instanceof Blob?t.size===0:!1}function x(t){let s=v;return q(v,r=>{const a=new AbortController;function e({data:n}){if(typeof n=="string"){const o=JSON.parse(n);if(Y(o)){s=o;return}}Z(n)||(s.payload=n),r(s)}return t==null||t.addEventListener("message",e,a),()=>a.abort()})}function ee(t,s){if(t){const r=()=>{const a={width:window.innerWidth,height:window.innerHeight};t.send(JSON.stringify(a))};switch(document.addEventListener("resize",r,s),t.addEventListener("close",()=>{document.removeEventListener("resize",r)}),t.readyState){case 0:t.addEventListener("open",r,s);break;case 1:r();break}}}function $(t){let s,r,a;const e=t[2].default,n=z(e,t,t[1],null);return{c(){s=B("div"),n&&n.c(),this.h()},l(o){s=D(o,"DIV",{class:!0});var i=P(s);n&&n.l(i),i.forEach(c),this.h()},h(){I(s,"class","layout svelte-e2gi4i")},m(o,i){p(o,s,i),n&&n.m(s,null),a=!0},p(o,i){t=o,n&&n.p&&(!a||i&2)&&L(n,e,t,t[1],a?C(e,t[1],i,null):k(t[1]),null)},i(o){a||(f(n,o),J(()=>{r||(r=h(s,b,{duration:w,easing:y},!0)),r.run(1)}),a=!0)},o(o){d(n,o),r||(r=h(s,b,{duration:w,easing:y},!1)),r.run(0),a=!1},d(o){o&&c(s),n&&n.d(o),o&&r&&r.end()}}}function te(t){let s=t[0],r,a,e=$(t);return{c(){e.c(),r=g()},l(n){e.l(n),r=g()},m(n,o){e.m(n,o),p(n,r,o),a=!0},p(n,[o]){o&1&&m(s,s=n[0])?(M(),d(e,1,1,N),O(),e=$(n),e.c(),f(e),e.m(r.parentNode,r)):e.p(n,o)},i(n){a||(f(e),a=!0)},o(n){d(e),a=!1},d(n){n&&c(r),e.d(n)}}}const w=300;function ne(t,s,r){let{$$slots:a={},$$scope:e}=s,{key:n=""}=s;return t.$$set=o=>{"key"in o&&r(0,n=o.key),"$$scope"in o&&r(1,e=o.$$scope)},[n,e,a]}class se extends S{constructor(s){super();E(this,s,ne,te,m,{key:0})}}function re(t){let s;const r=t[4].default,a=z(r,t,t[5],null);return{c(){a&&a.c()},l(e){a&&a.l(e)},m(e,n){a&&a.m(e,n),s=!0},p(e,n){a&&a.p&&(!s||n&32)&&L(a,r,e,e[5],s?C(r,e[5],n,null):k(e[5]),null)},i(e){s||(f(a,e),s=!0)},o(e){d(a,e),s=!1},d(e){a&&a.d(e)}}}function ae(t){let s,r,a;return r=new se({props:{key:t[0],$$slots:{default:[re]},$$scope:{ctx:t}}}),{c(){s=W(),j(r.$$.fragment),this.h()},l(e){A('[data-svelte="svelte-al2hjo"]',document.head).forEach(c),s=F(e),H(r.$$.fragment,e),this.h()},h(){document.title="Cell"},m(e,n){p(e,s,n),R(r,e,n),a=!0},p(e,[n]){const o={};n&1&&(o.key=e[0]),n&32&&(o.$$scope={dirty:n,ctx:e}),r.$set(o)},i(e){a||(f(r.$$.fragment,e),a=!0)},o(e){d(r.$$.fragment,e),a=!1},d(e){e&&c(s),G(r,e)}}}function fe(){return T("frame")}const de=async({url:t})=>{const s=t.searchParams.get("id");return s?{props:{serial:s}}:{status:400,error:new Error("Missing ID")}};function oe(t,s,r){let a,e,{$$slots:n={},$$scope:o}=s,{serial:i}=s;const l=X(i),_=x(l);return K(t,_,u=>r(3,e=u)),Q(()=>{ee(l)}),U("frame",{socket:l,state:_}),l==null||l.addEventListener("error",u=>console.error("Socket error",u)),l==null||l.addEventListener("open",u=>console.info("Socket open",u)),l==null||l.addEventListener("close",u=>console.info("Socket close",u)),t.$$set=u=>{"serial"in u&&r(2,i=u.serial),"$$scope"in u&&r(5,o=u.$$scope)},t.$$.update=()=>{t.$$.dirty&8&&r(0,a=`/cell/frame/${e.type.toLowerCase()}`),t.$$.dirty&8&&console.log("CellState",e),t.$$.dirty&5&&V(`${a}?id=${i}`,{replaceState:!0})},[a,_,i,e,n,o]}class _e extends S{constructor(s){super();E(this,s,oe,ae,m,{serial:2})}}export{_e as default,fe as getFrameContext,de as load};
