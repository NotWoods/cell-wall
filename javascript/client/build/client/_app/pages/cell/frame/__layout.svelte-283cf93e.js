import{U as q,S,i as E,s as m,e as D,c as P,a as B,d as c,b as I,g as p,G as k,H as L,I as C,q as f,P as J,Q as y,o as d,l as g,n as N,K as O,p as T,F as z,ah as h,ai as b,W,k as j,w as A,X as F,m as H,x as M,y as R,B as G,L as K,r as Q}from"../../../chunks/vendor-e399076d.js";import{g as U}from"../../../chunks/navigation-0e6511d1.js";import{b as v}from"../../../chunks/schema-7c735d14.js";import"../../../chunks/singletons-d1fb5791.js";function V(n){return new WebSocket(`ws://${window.location.host}/cells/${n}`)}function X(n){return n instanceof ArrayBuffer?n.byteLength===0:n instanceof Blob?n.size===0:!1}function Y(n){let s=v;return q(v,r=>{const o=new AbortController;function e({data:t}){if(typeof t=="string"){const a=JSON.parse(t);if(a&&typeof a=="object"&&"type"in a){s=a;return}}X(t)||(s.payload=t),r(s)}return n==null||n.addEventListener("message",e,o),()=>o.abort()})}function Z(n,s){if(n){const r=()=>{const o={width:window.innerWidth,height:window.innerHeight};console.log(n.readyState,"socket ready state"),n.send(JSON.stringify(o))};document.addEventListener("resize",r,s),n.addEventListener("close",()=>{document.removeEventListener("resize",r)})}}function $(n){let s,r,o;const e=n[2].default,t=z(e,n,n[1],null);return{c(){s=D("div"),t&&t.c(),this.h()},l(a){s=P(a,"DIV",{class:!0});var i=B(s);t&&t.l(i),i.forEach(c),this.h()},h(){I(s,"class","layout svelte-e2gi4i")},m(a,i){p(a,s,i),t&&t.m(s,null),o=!0},p(a,i){n=a,t&&t.p&&(!o||i&2)&&k(t,e,n,n[1],o?C(e,n[1],i,null):L(n[1]),null)},i(a){o||(f(t,a),J(()=>{r||(r=y(s,b,{duration:w,easing:h},!0)),r.run(1)}),o=!0)},o(a){d(t,a),r||(r=y(s,b,{duration:w,easing:h},!1)),r.run(0),o=!1},d(a){a&&c(s),t&&t.d(a),a&&r&&r.end()}}}function x(n){let s=n[0],r,o,e=$(n);return{c(){e.c(),r=g()},l(t){e.l(t),r=g()},m(t,a){e.m(t,a),p(t,r,a),o=!0},p(t,[a]){a&1&&m(s,s=t[0])?(N(),d(e,1,1,O),T(),e=$(t),e.c(),f(e),e.m(r.parentNode,r)):e.p(t,a)},i(t){o||(f(e),o=!0)},o(t){d(e),o=!1},d(t){t&&c(r),e.d(t)}}}const w=300;function ee(n,s,r){let{$$slots:o={},$$scope:e}=s,{key:t=""}=s;return n.$$set=a=>{"key"in a&&r(0,t=a.key),"$$scope"in a&&r(1,e=a.$$scope)},[t,e,o]}class te extends S{constructor(s){super();E(this,s,ee,x,m,{key:0})}}function ne(n){let s;const r=n[4].default,o=z(r,n,n[5],null);return{c(){o&&o.c()},l(e){o&&o.l(e)},m(e,t){o&&o.m(e,t),s=!0},p(e,t){o&&o.p&&(!s||t&32)&&k(o,r,e,e[5],s?C(r,e[5],t,null):L(e[5]),null)},i(e){s||(f(o,e),s=!0)},o(e){d(o,e),s=!1},d(e){o&&o.d(e)}}}function se(n){let s,r,o;return r=new te({props:{key:n[0],$$slots:{default:[ne]},$$scope:{ctx:n}}}),{c(){s=j(),A(r.$$.fragment),this.h()},l(e){F('[data-svelte="svelte-al2hjo"]',document.head).forEach(c),s=H(e),M(r.$$.fragment,e),this.h()},h(){document.title="Cell"},m(e,t){p(e,s,t),R(r,e,t),o=!0},p(e,[t]){const a={};t&1&&(a.key=e[0]),t&32&&(a.$$scope={dirty:t,ctx:e}),r.$set(a)},i(e){o||(f(r.$$.fragment,e),o=!0)},o(e){d(r.$$.fragment,e),o=!1},d(e){e&&c(s),G(r,e)}}}function ue(){return W("frame")}const ce=async({url:n})=>{const s=n.searchParams.get("id");return s?{props:{serial:s}}:{status:400,error:new Error("Missing ID")}};function re(n,s,r){let o,e,{$$slots:t={},$$scope:a}=s,{serial:i}=s;const l=V(i),_=Y(l);return K(n,_,u=>r(3,e=u)),Z(l),Q("frame",{socket:l,state:_}),l==null||l.addEventListener("error",u=>console.error("Socket error",u)),l==null||l.addEventListener("open",u=>console.info("Socket open",u)),l==null||l.addEventListener("close",u=>console.info("Socket close",u)),n.$$set=u=>{"serial"in u&&r(2,i=u.serial),"$$scope"in u&&r(5,a=u.$$scope)},n.$$.update=()=>{n.$$.dirty&8&&r(0,o=`/cell/frame/${e.type.toLowerCase()}`),n.$$.dirty&8&&console.log("CellState",e),n.$$.dirty&5&&U(`${o}?id=${i}`,{replaceState:!0})},[o,_,i,e,t,a]}class fe extends S{constructor(s){super();E(this,s,re,se,m,{serial:2})}}export{fe as default,ue as getFrameContext,ce as load};
