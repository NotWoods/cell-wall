import{U as B,S as C,i as z,s as b,e as m,c as p,a as D,d,b as f,g,G as M,H as T,I as A,q as _,P as I,Q as v,o as h,l as w,n as J,K as N,p as P,F as q,ah as $,ai as E,W,k as O,w as F,X as H,m as K,x as R,J as y,y as j,B as G,L as Q,v as U,r as V}from"../../../chunks/vendor-98a08ead.js";import{g as X}from"../../../chunks/navigation-0e6511d1.js";import{b as S}from"../../../chunks/cell-state-schema-a24ecc56.js";import"../../../chunks/singletons-d1fb5791.js";function Y(e){return new WebSocket(`ws://${window.location.host}/cells/${e}`)}function Z(e){return Boolean(e&&typeof e=="object"&&"type"in e)}function x(e){return e instanceof ArrayBuffer?e.byteLength===0:e instanceof Blob?e.size===0:!1}function ee(e){let a=S;return B(S,s=>{const r=new AbortController;function t({data:n}){if(typeof n=="string"){const o=JSON.parse(n);if(Z(o)){a=o;return}}x(n)||(a.payload=n),s(a)}return e==null||e.addEventListener("message",t,r),()=>r.abort()})}function te(e,a){if(e){const s=()=>{const r={width:window.innerWidth,height:window.innerHeight};e.send(JSON.stringify(r))};switch(document.addEventListener("resize",s,a),e.addEventListener("close",()=>{document.removeEventListener("resize",s)}),e.readyState){case 0:e.addEventListener("open",s,a);break;case 1:s();break}}}function k(e){let a,s,r;const t=e[2].default,n=q(t,e,e[1],null);return{c(){a=m("div"),n&&n.c(),this.h()},l(o){a=p(o,"DIV",{class:!0});var i=D(a);n&&n.l(i),i.forEach(d),this.h()},h(){f(a,"class","layout svelte-e2gi4i")},m(o,i){g(o,a,i),n&&n.m(a,null),r=!0},p(o,i){e=o,n&&n.p&&(!r||i&2)&&M(n,t,e,e[1],r?A(t,e[1],i,null):T(e[1]),null)},i(o){r||(_(n,o),I(()=>{s||(s=v(a,E,{duration:L,easing:$},!0)),s.run(1)}),r=!0)},o(o){h(n,o),s||(s=v(a,E,{duration:L,easing:$},!1)),s.run(0),r=!1},d(o){o&&d(a),n&&n.d(o),o&&s&&s.end()}}}function ne(e){let a=e[0],s,r,t=k(e);return{c(){t.c(),s=w()},l(n){t.l(n),s=w()},m(n,o){t.m(n,o),g(n,s,o),r=!0},p(n,[o]){o&1&&b(a,a=n[0])?(J(),h(t,1,1,N),P(),t=k(n),t.c(),_(t),t.m(s.parentNode,s)):t.p(n,o)},i(n){r||(_(t),r=!0)},o(n){h(t),r=!1},d(n){n&&d(s),t.d(n)}}}const L=300;function ae(e,a,s){let{$$slots:r={},$$scope:t}=a,{key:n=""}=a;return e.$$set=o=>{"key"in o&&s(0,n=o.key),"$$scope"in o&&s(1,t=o.$$scope)},[n,t,r]}class re extends C{constructor(a){super();z(this,a,ae,ne,b,{key:0})}}function se(e){let a;const s=e[4].default,r=q(s,e,e[5],null);return{c(){r&&r.c()},l(t){r&&r.l(t)},m(t,n){r&&r.m(t,n),a=!0},p(t,n){r&&r.p&&(!a||n&32)&&M(r,s,t,t[5],a?A(s,t[5],n,null):T(t[5]),null)},i(t){a||(_(r,t),a=!0)},o(t){h(r,t),a=!1},d(t){r&&r.d(t)}}}function oe(e){let a,s,r,t,n,o,i;return o=new re({props:{key:e[0],$$slots:{default:[se]},$$scope:{ctx:e}}}),{c(){a=m("meta"),s=m("meta"),r=m("meta"),t=m("link"),n=O(),F(o.$$.fragment),this.h()},l(l){const u=H('[data-svelte="svelte-ct4vxn"]',document.head);a=p(u,"META",{name:!0,content:!0}),s=p(u,"META",{name:!0,content:!0}),r=p(u,"META",{name:!0,content:!0}),t=p(u,"LINK",{rel:!0,sizes:!0,href:!0}),u.forEach(d),n=K(l),R(o.$$.fragment,l),this.h()},h(){document.title="Cell",f(a,"name","apple-mobile-web-app-capable"),f(a,"content","yes"),f(s,"name","apple-mobile-web-app-status-bar-style"),f(s,"content","black-translucent"),f(r,"name","apple-mobile-web-app-title"),f(r,"content","CellWall"),f(t,"rel","apple-touch-icon"),f(t,"sizes","274x274"),f(t,"href","/maskable_icon.png")},m(l,u){y(document.head,a),y(document.head,s),y(document.head,r),y(document.head,t),g(l,n,u),j(o,l,u),i=!0},p(l,[u]){const c={};u&1&&(c.key=l[0]),u&32&&(c.$$scope={dirty:u,ctx:l}),o.$set(c)},i(l){i||(_(o.$$.fragment,l),i=!0)},o(l){h(o.$$.fragment,l),i=!1},d(l){d(a),d(s),d(r),d(t),l&&d(n),G(o,l)}}}function de(){return W("frame")}const me=async({url:e})=>{const a=e.searchParams.get("id");return a?{props:{serial:a}}:{status:400,error:new Error("Missing ID")}};function le(e,a,s){let r,t,{$$slots:n={},$$scope:o}=a,{serial:i}=a;const l=Y(i),u=ee(l);return Q(e,u,c=>s(3,t=c)),U(()=>{te(l)}),V("frame",{socket:l,state:u}),l==null||l.addEventListener("error",c=>console.error("Socket error",c)),l==null||l.addEventListener("open",c=>console.info("Socket open",c)),l==null||l.addEventListener("close",c=>console.info("Socket close",c)),e.$$set=c=>{"serial"in c&&s(2,i=c.serial),"$$scope"in c&&s(5,o=c.$$scope)},e.$$.update=()=>{e.$$.dirty&8&&s(0,r=`/cell/frame/${t.type.toLowerCase()}`),e.$$.dirty&8&&console.log("CellState",t),e.$$.dirty&5&&X(`${r}?id=${i}`,{replaceState:!0})},[r,u,i,t,n,o]}class pe extends C{constructor(a){super();z(this,a,le,oe,b,{serial:2})}}export{pe as default,de as getFrameContext,me as load};
